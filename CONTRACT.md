# v1 Contract

This document defines the v1 behavioral contract, scope, and governance for the
library. It is intended for production integration and CI enforcement.

## v1 Guarantees (hard promises)

- No silent corruption of PPTX/XLSX. Postflight validation runs before commit.
- Structural determinism:
  - Same PPTX part set after edits (no unexpected new parts).
  - Relationship targets referenced by modified chart parts resolve to existing parts.
  - Chart caches are consistent with workbook edits when cache sync is enabled.
- Atomic save: output is written to a temp file and atomically renamed.
- Strict vs BestEffort semantics are stable (see below).
- Alerts are emitted for every skipped or invalid unit of work, with stable codes.

## v1 Non-Guarantees (explicit exclusions)

- Byte-identical ZIP output.
- Support for chart types beyond bar and line.
- Support for sharedStrings, formulas, 2D ranges, or combined charts.
- Automatic repair of malformed input files.

## Supported Scope Matrix (v1)

- Chart types: bar, line
- Range types: 1D only (row or column)
- String handling: inlineStr only
- Cache handling:
  - Sync: full rebuild of strCache/numCache for referenced ranges
  - Validation: invariant checks only (ptCount/idx/value correctness)

## Strict vs BestEffort (formal specification)

Unit of work: one chart and all related edits to its embedded workbook and chart
cache updates (if enabled).

Strict mode:
- Any validation failure aborts the operation.
- No partial updates are committed.

BestEffort mode:
- Invalid units of work are skipped.
- Alerts are emitted for each skipped unit.
- Other units proceed.
- No partial updates are committed for skipped units.

Failure classification:
- Input unsupported: skip in BestEffort; error in Strict.
  - Example: linked workbook chart.
- Structural corruption risk: fatal in both modes.
  - Examples: malformed output XML, unexpected new parts, sharedStrings usage,
    missing relationship targets, invalid chart cache invariants.

## Alert Code Governance

- Alert codes are part of the public contract.
- New alert codes: allowed in minor versions (v1.x).
- Renaming or removing alert codes: breaking change (v2+ only).
- All alerts include:
  - Level, Code, Message, Context (map).
  - Context should include relevant paths and mode when available:
    chartPath, slidePath, workbookPath, partPath, stage, mode.

Guidance:
- Treat alerts as structured diagnostics, not exceptions.
- In BestEffort, alerts indicate skipped units of work and should be monitored.

## CI / Release Checklist (v1)

- [ ] `go test ./...` passes, including corpus tests under `testdata/`.
- [ ] Strict-mode CI run passes.
- [ ] BestEffort-mode CI run passes.
- [ ] No unexpected ZIP entries introduced in fixture outputs.
- [ ] No new alert codes added without documentation update.
- [ ] CHANGELOG updated for release tag.
- [ ] ARCHITECTURE.md and CONTRACT.md updated if behavior changed.

## Compatibility Statement

- Tested with PPTX files generated by modern PowerPoint.
- Embedded XLSX is expected to use inlineStr (sharedStrings not supported).
- Not guaranteed for hand-edited XML, macro-enabled files, or unusual templates.

## Versioning and Deprecation Policy

- Semantic versioning is followed.
- Breaking changes require a major version (v2+).
- Minor versions may add capabilities and alert codes without breaking existing
  APIs or behavior.
- Patch versions contain bug fixes only.
- Deprecations are announced in minor releases and removed only in the next
  major version.
